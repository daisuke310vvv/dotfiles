# Neovim 使い方ガイド

## 📚 目次

1. [基本操作](#基本操作)
2. [ウィンドウ・ペイン操作](#ウィンドウペイン操作)
3. [Claude Code統合](#claude-code統合)
4. [ファイル検索・操作](#ファイル検索操作)
5. [Git操作](#git操作)
6. [よくある操作パターン](#よくある操作パターン)

---

## 基本操作

### リーダーキー
- **Leader**: `;` (セミコロン)
- すべての`<leader>`キーは`;`キーに置き換えてください

### モード切り替え
| 操作 | キー | 説明 |
|------|------|------|
| インサートモードから抜ける | `jk` | `Esc`の代替 |
| 検索ハイライトをクリア | `Esc` | 通常モードで実行 |

### ファイル保存・終了
| 操作 | キー |
|------|------|
| 保存 | `;`w` |
| 終了 | `;`q` |

---

## ウィンドウ・ペイン操作

### ウィンドウ間の移動

#### 方法1: Ctrl + 方向キー（推奨）
```
Ctrl-h  # 左のウィンドウへ
Ctrl-j  # 下のウィンドウへ
Ctrl-k  # 上のウィンドウへ
Ctrl-l  # 右のウィンドウへ
```

#### 方法2: Leader + 方向キー（tmux使用時）
```
;h  # 左のウィンドウへ
;j  # 下のウィンドウへ
;k  # 上のウィンドウへ
;l  # 右のウィンドウへ
```

### ターミナルモードからの脱出

**重要**: Claude Codeなどのターミナルウィンドウでは、まず通常モードに戻る必要があります。

1. **ターミナルモード → 通常モード**
   ```
   Ctrl-\ Ctrl-n
   ```
   または
   ```
   <C-\><C-n>
   ```

2. **その後、ウィンドウ移動**
   ```
   Ctrl-h/j/k/l  # 方向キーで移動
   ```

### バッファ移動
| 操作 | キー |
|------|------|
| 前のバッファ | `Shift-h` |
| 次のバッファ | `Shift-l` |

---

## Claude Code統合

### 基本操作

| 操作 | キー | 説明 |
|------|------|------|
| Claudeターミナルを開く/閉じる | `;`ac` | トグル動作 |
| Claudeにフォーカス | `;`af` | ターミナルにフォーカス |
| セッション再開 | `;`ar` | 前回のセッションを復元 |
| セッション継続 | `;`Ac` | 大文字C（Shift+c） |
| モデル選択 | `;`am` | Claude AIモデルを選択 |

### コンテキスト追加

| 操作 | キー | 説明 |
|------|------|------|
| 現在のファイルを追加 | `;`ab` | バッファ全体を追加 |
| 選択範囲を送信 | `;`as` | ビジュアルモードで選択後 |
| ファイルツリーから追加 | `;`as` | neo-tree上で実行 |

### Diff操作

| 操作 | キー | 説明 |
|------|------|------|
| 変更を受け入れ | `;`aa` | Accept |
| 変更を拒否 | `;`ad` | Deny |

### よくある使い方の流れ

#### パターン1: ファイルを開いてClaudeに質問
```
1. ;e          # neo-treeでファイル選択
2. Enter              # ファイルを開く
3. ;ac      # Claude Codeを開く
4. （質問を入力）
5. Ctrl-\ Ctrl-n      # ターミナルモードから抜ける
6. Ctrl-h             # neo-treeやエディタに戻る
```

#### パターン2: コード選択してClaudeに送信
```
1. v または V         # ビジュアルモードで選択
2. ;as      # 選択範囲をClaudeに送信
3. ;ac      # Claude Codeを開く
4. （質問を入力）
```

#### パターン3: Claude Codeから他のウィンドウへ移動
```
1. Ctrl-\ Ctrl-n      # ターミナルモードから通常モードへ
2. Ctrl-h             # 左のウィンドウ（neo-tree）へ
   または
   Ctrl-l             # 右のウィンドウ（エディタ）へ
```

---

## ファイル検索・操作

### Telescope（ファジーファインダー）

| 操作 | キー | 説明 |
|------|------|------|
| ファイル名で検索 | `;`ff` | プロジェクト内のファイル検索 |
| 内容で検索 | `;`fg` | 全文検索（grep） |
| バッファ一覧 | `;`fb` | 開いているファイル一覧 |
| 最近開いたファイル | `;`fr` | 履歴から検索 |
| ヘルプ検索 | `;`fh` | Vimヘルプを検索 |

### Neo-tree（ファイルツリー）

| 操作 | キー | 説明 |
|------|------|------|
| ファイルツリー表示切り替え | `;`e` | トグル |

**Neo-tree内の操作**:
- `Enter`: ファイルを開く
- `a`: 新しいファイル/ディレクトリを作成
- `d`: 削除
- `r`: リネーム
- `y`: コピー
- `x`: 切り取り
- `p`: 貼り付け

---

## Git操作

### Gitsigns（インライン Git操作）

| 操作 | キー | 説明 |
|------|------|------|
| 次の変更箇所へ | `]c` | Next hunk |
| 前の変更箇所へ | `[c` | Previous hunk |
| 変更をステージ | `;`hs` | Stage hunk |
| 変更をリセット | `;`hr` | Reset hunk |
| 変更をプレビュー | `;`hp` | Preview hunk |

### LazyGit（Git GUI）

| 操作 | キー | 説明 |
|------|------|------|
| LazyGitを起動 | `;`gg` | フルスクリーンGit UI |

---

## よくある操作パターン

### 3ペイン構成での作業（neo-tree + エディタ + Claude Code）

```
┌─────────────┬──────────────────┬─────────────────┐
│             │                  │                 │
│  neo-tree   │     エディタ     │  Claude Code    │
│  (左)       │     (中央)       │   (右)          │
│             │                  │                 │
└─────────────┴──────────────────┴─────────────────┘
```

#### ウィンドウ移動の基本
```
# Claude Code（ターミナルモード）にいる場合
Ctrl-\ Ctrl-n        # まず通常モードへ
Ctrl-h               # neo-treeへ移動
Ctrl-l               # エディタへ移動

# エディタにいる場合
Ctrl-h               # neo-treeへ移動
Ctrl-l               # Claude Codeへ移動（あれば）

# neo-treeにいる場合
Ctrl-l               # エディタへ移動
```

### コードレビューワークフロー

1. **ファイルを開く**: `;`e` → ファイル選択
2. **変更箇所を確認**: `]c` / `[c` で変更箇所を移動
3. **詳細を確認**: `;`hp` で差分プレビュー
4. **Claudeに質問**: `;`ac` → 質問入力
5. **LazyGitでコミット**: `;`gg`

### リファクタリングワークフロー

1. **コードを選択**: ビジュアルモードで範囲選択
2. **Claudeに送信**: `;`as`
3. **Claude Codeを開く**: `;`ac`
4. **リファクタリング提案を依頼**
5. **Diffを確認**: `;`aa` (受け入れ) / `;`ad` (拒否)

---

## LSP（Language Server Protocol）機能

| 操作 | キー | 説明 |
|------|------|------|
| 定義へジャンプ | `gd` | Go to definition |
| 参照を表示 | `gr` | Go to references |
| ホバー情報 | `K` | Shift + k |
| コードアクション | `;`ca` | Quick fix等 |
| リネーム | `;`rn` | 変数/関数名を一括変更 |
| 次のエラーへ | `]d` | Next diagnostic |
| 前のエラーへ | `[d` | Previous diagnostic |

---

## トラブルシューティング

### Claude Codeのターミナルから抜けられない
→ `Ctrl-\ Ctrl-n` で通常モードに戻ってから移動してください

### Ctrlキーが効かない（tmux使用時）
→ `;h/j/k/l` でウィンドウ移動が可能です

### which-keyが表示されない
→ `;`（セミコロン）を押して1秒待つと、利用可能なキーバインド一覧が表示されます

### プラグインが動かない
→ `:Lazy` でプラグインマネージャーを開き、プラグインの状態を確認してください

---

## 参考リンク

- **詳細なキーバインド一覧**: [keybindings.md](./keybindings.md)
- **設定ファイル**: [init.lua](./init.lua)
- **プラグインロック**: [lazy-lock.json](./lazy-lock.json)